<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!-- Address Structure Template -->
<template id="FAIAAddressStructure">
    <StreetName><t t-esc="address_data['street']"/></StreetName>
    <AdditionalAddressDetail><t t-esc="address_data['street2']"/></AdditionalAddressDetail>
    <City><t t-esc="address_data['city']"/></City>
    <PostalCode><t t-esc="address_data['zip']"/></PostalCode>
    <Region><t t-esc="address_data['state_code']"/></Region>
    <Country><t t-esc="address_data['country']"/></Country>
</template>

<!-- ContactHeaderStructure Template -->
<template id="FAIAContactHeaderStructure">
    <Contact>
        <ContactPerson>
            <Title><t t-esc="contact_data['title']"/></Title>
            <FirstName><t t-esc="contact_data['name']"/></FirstName>
            <LastName></LastName>
        </ContactPerson>
        <Telephone><t t-esc="contact_data['mobile'] or contact_data['phone']"/></Telephone>
        <Email><t t-esc="contact_data['email']"/></Email>
        <Website><t t-esc="contact_data['website']"/></Website>
    </Contact>
</template>

<!-- BankAccount Template -->
<template id="FAIABankAccountTemplate">
    <BankAccount t-foreach="bank_accounts" t-as="bank_account">
        <!--You have a CHOICE of the next 2 items at this level-->
        <BankAccountNumber><t t-esc="bank_account['acc_number']"/></BankAccountNumber>
        <BankAccountName><t t-esc="bank_account['bank_name']"/></BankAccountName>
        <SortCode><t t-esc="bank_account['bank_bic']"/></SortCode>
    </BankAccount>
</template>

<!-- TaxStructure Template -->
<template id="FAIATaxStructure">
    <TaxType><t t-esc="tax['tax_type']"/></TaxType>
    <TaxCode><t t-esc="tax['tax_code']"/></TaxCode>
    <TaxPercentage><t t-esc="tax['tax_percentage']" /></TaxPercentage>
    <TaxBaseDescription><t t-esc="tax['name']"/></TaxBaseDescription>
    <TaxAmount>
        <Amount><t t-esc="tax['amount']"/></Amount>
        <CurrencyCode t-if="tax['currency_code']"><t t-esc="tax['currency_code']"/></CurrencyCode>
        <!-- <CurrencyAmount t-if="tax['currency_amount']"><t t-esc="tax['currency_amount']"/></CurrencyAmount> -->
        <ExchangeRate t-if="tax.get('exchange_rate')"><t t-esc="tax['exchange_rate']"/></ExchangeRate>
    </TaxAmount>
</template>

<!-- CompanyStructure Template -->
<template id="FAIACompanyStructure">
    <RegistrationNumber t-if="partner.get('company_registry')"><t t-esc="partner['company_registry']"/></RegistrationNumber>
    <Name><t t-esc="partner['name']"/></Name>
    <Address>
        <!-- partner['addresses'] -->
        <t t-set="address_data" t-value="partner['address']"/>
        <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
    </Address>
    <Address t-foreach="partner['address']['other_address']" t-as="address_data">
        <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
    </Address>
    <!-- partner['contacts'] -->
    <t t-foreach="partner['address']['contact_address']" t-as="contact_data">
        <t t-call="l10n_lu_faia.FAIAContactHeaderStructure"/>
    </t>
    <TaxRegistration t-if="partner['tax_registration']">
        <TaxRegistrationNumber><t t-esc="partner['tax_registration']"/></TaxRegistrationNumber>
    </TaxRegistration>
    <t t-set="bank_accounts" t-value="partner['bank_accounts']"/>
    <t t-call="l10n_lu_faia.FAIABankAccountTemplate"/>
</template>

<!-- Template for Customer/Supplier -->
<template id="FAIACustomerSupplierTemplate">
    <t t-call="l10n_lu_faia.FAIACompanyStructure"/>
    <!-- t-if="partner.get('supplier_id')" -->
    <t t-if="customer">
        <CustomerID><t t-esc="partner['id']"/></CustomerID>
    </t>
    <!-- t-if="partner.get('customer_id')" -->
    <t t-if="not customer">
        <SupplierID><t t-esc="partner['id']"/></SupplierID>
    </t>
    <!-- partner['opening_balance'] -->
    <t t-set="customer_bal_from" t-value="partner['partner_balance_date_from']"/>
    <OpeningDebitBalance t-if="customer_bal_from['debit']">
        <t t-esc="customer_bal_from['debit']"/>
    </OpeningDebitBalance>
    <OpeningCreditBalance t-if="customer_bal_from['credit']">
        <t t-esc="customer_bal_from['credit']"/>
    </OpeningCreditBalance>
    <!-- partner['closing_balance'] -->
    <t t-set="customer_bal_to" t-value="partner['partner_balance_date_to']"/>
    <ClosingDebitBalance t-if="customer_bal_to['debit']">
        <t t-esc="customer_bal_to['debit']"/>
    </ClosingDebitBalance>
    <ClosingCreditBalance t-if="customer_bal_to['credit']">
        <t t-esc="customer_bal_to['credit']"/>
    </ClosingCreditBalance>
</template>


<!-- Main FAIA Template -->
<template id="FAIATemplate">
<AuditFile>
    <Header>
        <AuditFileVersion>2.01</AuditFileVersion>
        <t t-set="company" t-value="request.env.user.company_id"/>
        <AuditFileCountry><t t-esc="company.partner_id.country_id.code"/></AuditFileCountry>
        <AuditFileRegion><t t-esc="company.partner_id.state_id.code"/></AuditFileRegion>
        <AuditFileDateCreated><t t-esc="AuditFileDateCreated"/></AuditFileDateCreated>
        <SoftwareCompanyName>Odoo SA</SoftwareCompanyName>
        <SoftwareID>Odoo</SoftwareID>
        <SoftwareVersion><t t-esc="SoftwareVersion"/></SoftwareVersion>
        <Company>
            <t t-set="partner" t-value="company_data"/>
            <t t-call="l10n_lu_faia.FAIACompanyStructure"/>
        </Company>
        <DefaultCurrencyCode><t t-esc="company.currency_id.name"/></DefaultCurrencyCode>
        <SelectionCriteria>
            <SelectionStartDate><t t-esc="date_from"/></SelectionStartDate>
            <SelectionEndDate><t t-esc="date_to"/></SelectionEndDate>
        </SelectionCriteria>
        <TaxAccountingBasis>Invoice Accounting</TaxAccountingBasis>
    </Header>
    <MasterFiles>
        <GeneralLedgerAccounts t-if="accounts">
            <Account t-foreach="accounts" t-as="account">
                <AccountID><t t-esc="account['id']"/></AccountID>
                <AccountDescription><t t-esc="account['name']"/></AccountDescription>
                <StandardAccountID><t t-esc="account['code']"/></StandardAccountID>
                <GroupingCategory t-if="account['group_code']"><t t-esc="account['group_code']"/></GroupingCategory>
                <GroupingCode t-if="account['group_categ']"><t t-esc="account['group_categ']"/></GroupingCode>
                <AccountType><t t-esc="account['acccount_type']"/></AccountType>
                <OpeningDebitBalance t-if="account['account_balance_date_from']['opening_debit']">
                    <t t-esc="account['account_balance_date_from']['opening_debit']"/>
                </OpeningDebitBalance>
                <OpeningCreditBalance t-if="not account['account_balance_date_from']['opening_debit']">
                    <t t-esc="account['account_balance_date_from']['opening_credit']"/>
                </OpeningCreditBalance>
                <ClosingDebitBalance t-if="account['account_balance_date_to']['opening_debit']">
                    <t t-esc="account['account_balance_date_to']['opening_debit']"/>
                </ClosingDebitBalance>
                <ClosingCreditBalance t-if="not account['account_balance_date_to']['opening_debit']">
                    <t t-esc="account['account_balance_date_to']['opening_credit']"/>
                </ClosingCreditBalance>
            </Account>
        </GeneralLedgerAccounts>
        <Customers t-if="customers">
            <Customer t-foreach="customers" t-as="partner">
                <t t-set="customer" t-value="True"/>
                <t t-call="l10n_lu_faia.FAIACustomerSupplierTemplate"/>
            </Customer>
        </Customers>
        <Suppliers t-if="suppliers">
            <Supplier t-foreach="suppliers" t-as="partner">
                <t t-set="customer" t-value="False"/>
                <t t-call="l10n_lu_faia.FAIACustomerSupplierTemplate"/>
            </Supplier>
        </Suppliers>
        <TaxTable t-if="taxes">
            <TaxTableEntry t-foreach="taxes" t-as="TaxTableEntry">
                <TaxType><t t-esc="TaxTableEntry['tax_type']"/></TaxType>
                <Description>Taxe sur la valeur ajout&amp;#xC3;&amp;#xA9;e</Description>
                <TaxCodeDetails>
                    <TaxCode><t t-esc="TaxTableEntry['tax_code']"/></TaxCode>
                    <Description><t t-esc="TaxTableEntry['description']"/></Description>
                    <!--You have a CHOICE of the next 2 items at this level-->
                    <TaxPercentage t-if="TaxTableEntry.get('percent_amount')"><t t-esc="TaxTableEntry['percent_amount']"/></TaxPercentage>
                    <FlatTaxRate t-if="TaxTableEntry.get('fix_amount')">
                        <Amount><t t-esc="TaxTableEntry['fix_amount']"/></Amount>
                        <CurrencyCode t-if="TaxTableEntry['currency_code']"><t t-esc="TaxTableEntry['currency_code']"/></CurrencyCode>
                        <!-- <CurrencyAmount t-if="TaxTableEntry['currency_amount']"><t t-esc="TaxTableEntry['currency_amount']"/></CurrencyAmount> -->
                    </FlatTaxRate>
                    <Country><t t-esc="TaxTableEntry['country']"/></Country>
                    <Region><t t-esc="TaxTableEntry['state_code']"/></Region>
                </TaxCodeDetails>
            </TaxTableEntry>
        </TaxTable>
        <UOMTable t-if="uom_entries">
            <UOMTableEntry t-foreach="uom_entries" t-as="UOMTableEntry">
                <UnitOfMeasure><t t-esc="UOMTableEntry['measure']"/></UnitOfMeasure>
                <Description><t t-esc="UOMTableEntry['description']"/></Description>
            </UOMTableEntry>
        </UOMTable>
        <Products t-if="products">
            <Product t-foreach="products" t-as="product">
                <ProductCode><t t-esc="product['product_code']"/></ProductCode>
                <ProductGroup><t t-esc="product['group']"/></ProductGroup>
                <Description><t t-esc="product['description']"/></Description>
                <ProductNumberCode><t t-esc="product['product_number_code']"/></ProductNumberCode>
                <!-- valuation >> cost_method -->
                <ValuationMethod><t t-esc="product['valuation']"/></ValuationMethod>
                <UOMBase><t t-esc="product['uom_base']"/></UOMBase>
                <UOMStandard><t t-esc="product['uom_standard']"/></UOMStandard>
                <UOMToUOMBaseConversionFactor><t t-esc="product['convert_fact']"/></UOMToUOMBaseConversionFactor>
                <!--Zero or more repetitions:-->
                <Tax t-foreach="product['taxes']" t-as="tax">
                    <TaxType><t t-esc="tax['type']"/></TaxType>
                    <TaxCode><t t-esc="tax['code']"/></TaxCode>
                </Tax>
            </Product>
        </Products>
        <Owners>
            <Owner>
<!--                 <t t-set="partner" t-value="company_data"/>
                <t t-call="l10n_lu_faia.FAIACompanyStructure"/> -->
                 <Name><t t-esc="company.name"/></Name>
                <Address>
                    <t t-set="address_data" t-value="owner_address['address']"/>
                    <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                </Address>
                <Address t-foreach="owner_address['address']['other_address']" t-as="address_data">
                    <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                </Address>
                <t t-foreach="owner_address['address']['contact_address']" t-as="contact_data">
                    <t t-call="l10n_lu_faia.FAIAContactHeaderStructure"/>
                </t>
                <TaxRegistration t-if="company.vat">
                    <TaxRegistrationNumber><t t-esc="company.vat"/></TaxRegistrationNumber>
                </TaxRegistration>
                <t t-set="bank_accounts" t-value="company.bank_ids"/>
                <t t-call="l10n_lu_faia.FAIABankAccountTemplate"/>
                <OwnerID><t t-esc="company.id"/></OwnerID>
            </Owner>
        </Owners>
    </MasterFiles>
    <GeneralLedgerEntries>
        <NumberOfEntries><t t-esc="len(general_ledger['journals'])"/></NumberOfEntries>
        <TotalDebit><t t-esc="general_ledger['total_debit']"/></TotalDebit>
        <TotalCredit><t t-esc="general_ledger['total_credit']"/></TotalCredit>
        <Journal t-foreach="general_ledger['journals']" t-as="journal">
            <JournalID><t t-esc="journal['journal_id']"/></JournalID>
            <Description><t t-esc="journal['description']"/></Description>
            <Type><t t-esc="journal['type']"/></Type>
            <Transaction t-foreach="journal['transactions']" t-as="move">
                <TransactionID><t t-esc="move['transaction_id']"/></TransactionID>
                <Period><t t-esc="move['period']"/></Period>
                <PeriodYear><t t-esc="move['period_year']"/></PeriodYear>
                <TransactionDate><t t-esc="move['transaction_date']"/></TransactionDate>
                <SourceID><t t-esc="move['source_id']"/></SourceID>
                <TransactionType><t t-esc="move['transaction_type']"/></TransactionType>
                <Description><t t-esc="move['description']"/></Description>
                <SystemEntryDate><t t-esc="move['system_entry_date']"/></SystemEntryDate>
                <GLPostingDate><t t-esc="move['glposting_date']"/></GLPostingDate>
                <CustomerID t-if="move['customer_id']"><t t-esc="move['customer_id']"/></CustomerID>
                <SupplierID t-if="move['supplier_id']"><t t-esc="move['supplier_id']"/></SupplierID>
                <Line t-foreach="move['lines']" t-as="line">
                    <RecordID><t t-esc="line['record_id']"/></RecordID>
                    <AccountID><t t-esc="line['account_id']"/></AccountID>
                    <ValueDate><t t-esc="line['valuedate']"/></ValueDate>
                    <SourceDocumentID><t t-esc="line['sourcedocument_id']"/></SourceDocumentID>
                    <CustomerID t-if="line['customer_id']"><t t-esc="line['customer_id']"/></CustomerID>
                    <SupplierID t-if="line['supplier_id']"><t t-esc="line['supplier_id']"/></SupplierID>
                    <Description><t t-esc="line['description']"/></Description>
                    <DebitAmount t-if="line.get('debit_amount')">
                        <Amount><t t-esc="line['debit_amount']['amount']"/></Amount>
                        <CurrencyCode t-if="line['debit_amount']['currency_code']"><t t-esc="line['debit_amount']['currency_code']"/></CurrencyCode>
                        <!-- <CurrencyAmount t-if="line['debit_amount']['currency_amount']"><t t-esc="line['debit_amount']['currency_amount']"/></CurrencyAmount> -->
                    </DebitAmount>
                    <CreditAmount t-if="line.get('credit_amount')">
                        <Amount><t t-esc="line['credit_amount']['amount']"/></Amount>
                        <CurrencyCode t-if="line['credit_amount']['currency_code']"><t t-esc="line['credit_amount']['currency_code']"/></CurrencyCode>
                        <!-- <CurrencyAmount t-if="line['credit_amount']['currency_amount']"><t t-esc="line['credit_amount']['currency_amount']"/></CurrencyAmount> -->
                    </CreditAmount>
                    <TaxInformation t-foreach="line.get('tax_information')" t-as="tax">
                        <t t-call="l10n_lu_faia.FAIATaxStructure"/>
                    </TaxInformation>
                </Line>
            </Transaction>
        </Journal>
    </GeneralLedgerEntries>
    <SourceDocuments>
        <SalesInvoices t-if="sales_invoices['invoices']">
            <NumberOfEntries><t t-esc="len(sales_invoices['invoices'])"/></NumberOfEntries>
            <TotalDebit><t t-esc="sales_invoices['total_debit']"/></TotalDebit>
            <TotalCredit><t t-esc="sales_invoices['total_credit']"/></TotalCredit>
            <Invoice t-foreach="sales_invoices['invoices']" t-as="invoice">
                <InvoiceNo><t t-esc="invoice['invoice_no']"/></InvoiceNo>
                <CustomerInfo t-if="invoice['customer_info']">
                    <CustomerID><t t-esc="invoice['partner_id']"/></CustomerID>
                    <BillingAddress>
                        <t t-set="address_data" t-value="invoice['customer_info']"/>
                        <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                    </BillingAddress>
                </CustomerInfo>
                <SupplierInfo t-if="invoice['supplier_info']">
                    <SupplierID><t t-esc="invoice['partner_shipping_id']"/></SupplierID>
                    <BillingAddress>
                        <t t-set="address_data" t-value="invoice['supplier_info']"/>
                        <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                    </BillingAddress>
                </SupplierInfo>
                <AccountID><t t-esc="invoice['account_id']"/></AccountID>
                <Period><t t-esc="invoice['period']"/></Period>
                <PeriodYear><t t-esc="invoice['period_year']"/></PeriodYear>
                <InvoiceDate><t t-esc="invoice['invoice_date']"/></InvoiceDate>
                <InvoiceType><t t-esc="invoice['invoice_type']"/></InvoiceType>
                <ShipTo t-if="invoice.get('ship_to_address')">
                    <DeliveryDate><t t-esc="invoice.get('ship_to_delivery_date')"/></DeliveryDate>
                    <Address>
                        <t t-set="address_data" t-value="invoice['ship_to_address']"/>
                        <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                    </Address>
                </ShipTo>
                <ShipFrom>
                    <DeliveryDate><t t-esc="invoice['ship_from_delivery_date']"/></DeliveryDate>
                    <Address>
                        <t t-set="address_data" t-value="invoice['ship_from_address']"/>
                        <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                    </Address>
                </ShipFrom>
                <PaymentTerms><t t-esc="invoice['payment_term_id']"/></PaymentTerms>
                <SourceID t-if="invoice['source_id']"><t t-esc="invoice['source_id']"/></SourceID>
                <GLPostingDate><t t-esc="invoice['gl_posting_date']"/></GLPostingDate>
                <TransactionID><t t-esc="invoice['transaction_id']"/></TransactionID>
                <ReceiptNumbers t-if="invoice['receipt_number']"><t t-esc="invoice['receipt_number']"/></ReceiptNumbers>
                <Line t-foreach="invoice['lines']" t-as="line">
                    <LineNumber><t t-esc="line.get('line_number')"/></LineNumber>
                    <AccountID><t t-esc="line.get('account_id')"/></AccountID>
                    <OrderReferences>
                        <OriginatingON><t t-esc="line.get('order_ref')"/></OriginatingON>
                    </OrderReferences>
                    <ShipTo>
                        <DeliveryDate><t t-esc="line.get('ship_delivery_date')"/></DeliveryDate>
                        <Address>
                            <t t-set="address_data" t-value="line['ship_to_address']"/>
                            <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                        </Address>
                    </ShipTo>
                    <ShipFrom>
                        <DeliveryDate><t t-esc="line.get('ship_delivery_date')"/></DeliveryDate>
                        <Address>
                            <t t-set="address_data" t-value="line['ship_from_address']"/>
                            <t t-call="l10n_lu_faia.FAIAAddressStructure"/>
                        </Address>
                    </ShipFrom>
                    <ProductCode t-if="line.get('product_code')"><t t-esc="line.get('product_code')"/></ProductCode>
                    <ProductDescription><t t-esc="line.get('product_desc')"/></ProductDescription>
                    <Delivery>
                        <DeliveryDate><t t-esc="line.get('delivery_date')"/></DeliveryDate>
                    </Delivery>
                    <Quantity><t t-esc="line.get('quantity')"/></Quantity>
                    <InvoiceUOM t-if="line.get('uom_id')"><t t-esc="line.get('uom_id')"/></InvoiceUOM>
                    <UOMToUOMBaseConversionFactor><t t-esc="line.get('convert_fact')"/></UOMToUOMBaseConversionFactor>
                    <UnitPrice><t t-esc="line.get('unit_price')" /></UnitPrice>
                    <TaxPointDate><t t-esc="line.get('to_point_date')"/></TaxPointDate>
                    <References>
                        <CreditNote t-foreach="line.get('credit_note')" t-as="creditnote">
                            <Reference t-if="creditnote.get('reference')"><t t-esc="creditnote.get('reference')"/></Reference>
                            <Reason><t t-esc="creditnote.get('reason')"/></Reason>
                        </CreditNote>
                    </References>
                    <Description><t t-esc="line.get('description')"/></Description>
                    <InvoiceLineAmount>
                        <Amount><t t-esc="line.get('amount')"/></Amount>
                        <CurrencyCode t-if="line.get('currency_code')"><t t-esc="line.get('currency_code')"/></CurrencyCode>
                        <!-- <CurrencyAmount t-if="line.get('currency_amount')"><t t-esc="line.get('currency_amount')"/></CurrencyAmount> -->
                        <ExchangeRate t-if="line.get('exchange_rate')"><t t-esc="line.get('exchange_rate')"/></ExchangeRate>
                    </InvoiceLineAmount>
                    <DebitCreditIndicator><t t-esc="line.get('indicator')"/></DebitCreditIndicator>
                </Line>
                <DocumentTotals>
                    <TaxInformationTotals t-foreach="invoice.get('tax_information')" t-as="tax">
                        <t t-call="l10n_lu_faia.FAIATaxStructure"/>
                    </TaxInformationTotals>
                    <NetTotal><t t-esc="invoice.get('net_total')" /></NetTotal>
                    <GrossTotal><t t-esc="invoice.get('gross_total')" /></GrossTotal>
                </DocumentTotals>
            </Invoice>
        </SalesInvoices>
    </SourceDocuments>
</AuditFile>
</template>
</odoo>
